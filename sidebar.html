<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
	
	<title>滑动侧边栏</title>
	
	
    
</head>
<body id="body">
	
	<div id="mySidebar">
		<div id="xin_menu">
			<div>
				第二卦 坤 坤为地 坤上坤下坤：元，亨，利牝马之贞。君子有攸往，先迷后得主，利西南得朋，东北丧朋。安贞，吉。彖曰：至哉坤元，万物资生，乃顺承天。坤厚载物，德合无疆。含弘光大，品物咸亨。牝马地类，行地无疆，柔顺利贞。君子攸行，先迷失道，后顺得常。西南得朋，乃与类行；东北丧朋，乃终有庆。安贞之吉，应地无疆。象曰：地势坤，君子以厚德载物。初六：履霜，坚冰至。象曰：履霜坚冰，阴始凝也。驯致其道，至坚冰也。六二：直，方，大，不习无不利。象曰：六二之动，直以方也。不习无不利，地道光也。六三：含章可贞。或从王事，无成有终。象曰：含章可贞；以时发也。或从王事，知光大也。六四：括囊；无咎，无誉。象曰：括囊无咎，慎不害也。六五：黄裳，元吉。象曰：黄裳元吉，文在中也。上六：战龙於野，其血玄黄。象曰：战龙於野，其道穷也。用六：利永贞。象曰：用六永贞，以大终也。文言曰：坤至柔，而动也刚，至静而德方，后得主而有常，含万物而化光。坤其道顺乎？承天而时行。积善之家，必有馀庆；积不善之家，必有馀殃。臣弑其君，子弑其父，非一朝一夕之故，其所由来者渐矣，由辩之不早辩也。易曰：「履霜坚冰至。」盖言顺也。直其正也，方其义也。君子敬以直内，义以方外，敬义立，而德不孤。「直，方，大，不习无不利」；则不疑其所行也。阴虽有美，含之；以从王事，弗敢成也。地道也，妻道也，臣道也。地道无成，而代有终也。天地变化，草木蕃；天地闭，贤人隐。易曰：「括囊；无咎，无誉。」盖言谨也。君子黄中通理，正位居体，美在其中，而畅於四支，发於事业，美之至也。阴疑於阳，必战。为其嫌於无阳也，故称龙焉。犹未离其类也，故称血焉。夫玄黄者，天地之杂也，天玄而地黄。
			</div>
		</div>
		
		<div id="xin_main">
			<div id="main_head">
				<button onclick="closeMenu()">《《《</button>
				<button onclick="openMenu()">》》》</button>头部
			</div>
			
			<div id="main_center">
				<div>
					第一卦 乾 乾为天 乾上乾下乾：元，亨，利，贞。初九：潜龙，勿用。九二：见龙再田，利见大人。九三：君子终日乾乾，夕惕若，厉无 咎。九四：或跃在渊，无咎。九五：飞龙在天，利见大人。上九：亢龙有悔。用九：见群龙 无首，吉。彖曰：大哉乾元，万物资始，乃统天。云行雨施，品物流形。大明始终，六位时成，时 乘六龙以御天。乾道变化，各正性命，保合大和，乃利贞。首出庶物，万国咸宁。象曰：天行健，君子以自强不息。潜龙勿用，阳在下也。见龙再田，德施普也。终日乾 乾，反复道也。或跃在渊，进无咎也。飞龙在天，大人造也。亢龙有悔，盈不可久也。用 九，天德不可为首也。文言曰：「元者，善之长也，亨者，嘉之会也，利者，义之和也，贞者，事之干也。君 子体仁，足以长人；嘉会，足以合礼；利物，足以和义；贞固，足以干事。君子行此四者， 故曰：乾：元亨利贞。」初九曰：「潜龙勿用。」何谓也？子曰：「龙德而隐者也。不易乎世，不成乎名；遯 世而无闷，不见是而无闷；乐则行之，忧则违之；确乎其不可拔，乾龙也。」九二曰：「见龙在田，利见大人。」何谓也？子曰：「龙德而正中者也。庸言之信，庸 行之谨，闲邪存其诚，善世而不伐，德博而化。易曰：「见龙在田，利见大人。」君德 也。」九三曰：「君子终日乾乾，夕惕若，厉无咎。」何谓也？子曰：「君子进德修业，忠 信，所以进德也。修辞立其诚，所以居业也。知至至之，可与几也。知终终之，可与存义 也。是故，居上位而不骄，在下位而不忧。故乾乾，因其时而惕，虽危而无咎矣。」九四：「或跃在渊，无咎。」何谓也？子曰：「上下无常，非为邪也。进退无恒，非离 群也。君子进德修业，欲及时也，故无咎。」九五曰：「飞龙在天，利见大人。」何谓也？子曰：「同声相应，同气相求；水流湿， 火就燥；云从龙，风从虎。圣人作，而万物覩，本乎天者亲上，本乎地者亲下，则各从其 类也。上九曰：「亢龙有悔。」何谓也？子曰：「贵而无位，高而无民，贤人在下而无辅，是 以动而有悔也。」乾龙勿用，下也。见龙在田，时舍也。终日乾乾，行事也。或跃在渊，自试也。飞龙在 天，上治也。亢龙有悔，穷之灾也。乾元用九，天下治也。乾龙勿用，阳气潜藏。见龙在田，天下文明。终日乾乾，与时偕行。或跃在渊，乾道乃 革。飞龙在天，乃位乎天德。亢龙有悔，与时偕极。乾元用九，乃见天则。乾元者，始而亨者也。利贞者，性情也。乾始能以美利利天下，不言所利。大矣哉！大 哉乾乎？刚健中正，纯粹精也。六爻发挥，旁通情也。时乘六龙，以御天也。云行雨施，天 下平也。君子以成德为行，日可见之行也。潜之为言也，隐而未见，行而未成，是以君子弗用 也。君子学以聚之，问以辩之，宽以居之，仁以行之。易曰：「见龙在田，利见大人。」君 德也。九三，重刚而不中，上不在天，下不在田。故乾乾，因其时而惕，虽危无咎矣。九四，重刚而不中，上不在天，下不在田，中不在人，故或之。或之者，疑之也，故无 咎。夫大人者，与天地合其德，与日月合其明，与四时合其序，与鬼神合其吉凶。先天下而 天弗违，后天而奉天时。天且弗违，而况於人乎？况於鬼神乎？亢之为言也，知进而不知退，知存而不知亡，知得而不知丧。其唯圣人乎？知进退存 亡，而不失其正者，其为圣人乎？
				</div>
			</div>
			
			<div id="main_foot">
				底部
			</div>
		</div>
	
	</div>
	<script>
		window.onload=function (){
			initXinSidebar({
				
					id:			"mySidebar",
					width:		200,	//菜单组件宽度
					change:		900,	//当屏幕宽度大于多少时改变模式
					touchArea: 	60,		//触摸区域，打开菜单
					data:		null	//开发中
			});
		}
		
	</script>
		
		
		
		
		
		
		
		
	<!-- 一下为组件所有css样式和js文件 -->	
	<!-- 一下为组件所有css样式和js文件 -->		
	<!-- 一下为组件所有css样式和js文件 -->		
	<style>
		/* 组件必须的CSS样式 */
		#body{
			padding: 0px;
			margin:	0px;
			overflow:hidden;	/*避免出现滚动条*/
		}
		#xin_menu{
			background-color:gray;
			float: left;
			overflow:auto;    	/*当内容超出div时出现滚动条*/  
		}
		
		#xin_main{
			background-color:yellow;
			position:fixed ;
			overflow:auto;
		}
		#main_head{
			background-color:red;
			float:		left;
			overflow:	auto;
		}
		
		#main_center{
			background-color:blue;
			float:		left;
			overflow:	auto;
			
		}
		#main_foot{
			background-color:green;
			float:		left;
			overflow:	auto;
		}
		
		
	</style>
	<script>
		//定时输出器 调试用
		var t1=window.setInterval(function() {
			console.log(main_x+"  "+page_width+"  "+menu_isOpen);
		}, 100);
		
		
		
		//全局数据 静态
		var xin_menu; 	//菜单dom
		var xin_main;	//主界面dom
		var main_head;
		var main_center;
		var main_foot;
		
		var menu_width;	//菜单宽度
		var change_value;//模式改变值  在手机 和 pc 间变化模式
		var touchArea	//开始触摸位置
		//全局数据 动态
		var page_width;	//页面宽度
		var page_height;//高度
		var menu_isOpen;//菜单打开了吗
		var main_x;		//主界面x坐标
	
		
		
		
		
		
		// 初始化侧边栏组件
		function initXinSidebar(mySidebar){
		
			
			//遍历赋值
			var sidebarChildNodes = document.getElementById(mySidebar.id).childNodes
			for( var i in sidebarChildNodes){
				if(sidebarChildNodes[i].id == "xin_menu"){
					xin_menu = sidebarChildNodes[i];
				}
				if(sidebarChildNodes[i].id == "xin_main"){
					xin_main = sidebarChildNodes[i];
					for(x in xin_main.childNodes){
						if(xin_main.childNodes[x].id == "main_head"){
							main_head = xin_main.childNodes[x];
						}
						if(xin_main.childNodes[x].id == "main_center"){
							main_center = xin_main.childNodes[x];
						}
						if(xin_main.childNodes[x].id == "main_foot"){
							main_foot = xin_main.childNodes[x];
						}
					}
				}
			}
			menu_width	= mySidebar.width;
			change_value= mySidebar.change;
			touchArea 	= mySidebar.touchArea;
			
			//刷新数据
			function refreshData(){
				//动态值
				page_width =  document.documentElement.clientWidth;  //刷新页面宽
				page_height = document.documentElement.clientHeight; //刷新页面高
				
				
				//初始化body  宽和高
				document.getElementsByTagName('body')[0].style.width = page_width+'px';
				document.getElementsByTagName('body')[0].style.height = page_height+'px';
				
				//初始化 菜单 宽和高
				xin_menu.style.width  = menu_width+"px";
				xin_menu.style.height = page_height+'px';
				
				//初始化 主界面 高
				xin_main.style.height = page_height+'px';
				main_center.style.height = page_height - main_head.scrollHeight  - main_foot.scrollHeight +'px';
				//初始化 主界面 宽
				if(page_width >= change_value){//如果页面宽度 大于 用户模式改变值
					main_head.style.width = 
					main_center.style.width = 
					main_foot.style.width = 
					xin_main.style.width = page_width - menu_width +"px";
					setMainX(menu_width);
					menu_isOpen = true;
				}else{
					main_head.style.width = 
					main_center.style.width = 
					main_foot.style.width = 
					xin_main.style.width= page_width +"px";
					setMainX(0);
					menu_isOpen = false;
				}
			}
			
			refreshData();
			
			//当页面大小改变时调用此方法 进行 刷新操作
			window.onresize = function(){
				refreshData();
			}
			
			
			/*
				实现滑动功能
			*/
			
			var start_x; //开始触摸的x坐标
			var start_y; //开始触摸的y坐标
			
			var activeSwap = false; //是否激活了滑动
			
			
			
			// 控制main移动
			function doSwap (move_x){
				
				
				//算出移动距离
				var distance = move_x  - start_x;
				
				//为了让 主界面 在限定位置移动
				if( (distance < 0 && distance > -menu_width && menu_isOpen) ){ //关闭菜单
					setMainX(menu_width + distance);
				}
				
				if(  (distance > 0 && distance < menu_width && !menu_isOpen) ){//打开菜单
					setMainX(distance);
				}
			}
			
			//触摸开始
			xin_main.addEventListener("touchstart", function(e){
				start_x = e.targetTouches[0].pageX;
				start_y = e.targetTouches[0].pageY;
			});
			
			
			//触摸移动
			xin_main.addEventListener("touchmove", function(e){
				//判断开始坐标是否在所规定滑动区域内    菜单关闭 || 菜单打开
				if( (start_x > 0 && start_x < touchArea && !menu_isOpen)  ||  (start_x>menu_width && menu_isOpen)  ){
					activeSwap = true;
					
					//交给setMainX
					doSwap( e.touches[0].pageX);
					
					
				}else{activeSwap = false;}
			});


			//触摸停止
			xin_main.addEventListener("touchend", function(e){
				
				
				if(activeSwap){
					var end_x = e.changedTouches[0].pageX;
					var end_y = e.changedTouches[0].pageY;

					if(menu_isOpen){//菜单为开启状态
						if(  ((start_x - end_x) > ( menu_width/2)) ){ //符合规定滑动距离
							closeMenu();
						}else{
							openMenu();
						}

					}else{//关闭状态
						if(  ((end_x - start_x) > menu_width/2) ){
							openMenu();
						}else{
							closeMenu();
						}
					}
				}
				activeSwap = false; //关闭滑动
			});
		
			
			
			
			
		}
		
		//关闭菜单
		function closeMenu(){
			var t1=window.setInterval(function() {
				if(main_x <= 0){
					setMainX(0);
					
					window.clearInterval(t1); 
					menu_isOpen = false;
					return;
				}else{
					moveMain(-4);
				}
			}, 1);
		}
		
		//打开菜单
		function openMenu(){
			var t2=window.setInterval(function() {
				if(main_x >= menu_width){
					setMainX(menu_width);
					window.clearInterval(t2); 
					menu_isOpen = true;
					return;
				}else{
					moveMain(4);
				}
			}, 1);
		}
		
		
		// 移动主界面   x：移动值  +or-
		function moveMain(x){
			var x = parseInt(x);
			main_x = parseInt(  xin_main.style.transform.split("(")[1].split("p")[0]  );
			
			xin_main.style.transform = "translateX("+(x+main_x)+"px)";
			
			main_x = parseInt(  xin_main.style.transform.split("(")[1].split("p")[0]  );
			
			//刷新主界面宽度
			if(page_width >= change_value){
				main_head.style.width = 
				main_center.style.width = 
				main_foot.style.width = 
				xin_main.style.width = page_width - main_x +"px";
			}
			
		}
		
		// 设置主界面位置   x：相对于父节点 -
		function setMainX(input_main_x){
		
			
			main_x = parseInt(input_main_x);
			xin_main.style.transform = "translateX("+main_x+"px)";
			//刷新主界面宽度
			if(page_width >= change_value){
				main_head.style.width = 
				main_center.style.width = 
				main_foot.style.width = 
				xin_main.style.width = page_width - main_x +"px";
			}
			
		}
	</script>
</body>
</html>